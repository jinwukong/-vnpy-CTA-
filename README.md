## 项目简介
基于 **vnpy(Veighna)** 框架的高频价量研究策略示例，参考并复现了东吴证券的一系列研报对 CPV（价量相关因子）的思路，并对实际的 T+0 / T+1 持仓拆分、DOV 指标和交割周期处理进行了示例化编写。

- **核心文件**：`cpv4cta.py`
  - 包含了拆分 T+0 和 T+1 交易者的核心逻辑，计算修正后的持仓量序列，再基于此序列与收盘价计算价量相关系数 PV。
  - 在收盘前统计 DOV（|∆OI| / ∆Volume） 的均值和标准差，用于判断当日交易者结构（倾向机构或散户）以及次日信号是否要反转。

## 背景与思路

1. **价量相关性 (PV 因子)**  
   通过计算当日（或分钟级别）价格与持仓量 (OI) 的相关系数，来判断市场是 “放量上涨” 还是 “放量下跌” 等情况。  
   - PV > 0：一般视为多头信号  
   - PV < 0：一般视为空头信号  

2. **T+0 / T+1 持仓拆分**  
   2015 年以后，为规避“平今仓”高手续费，许多日内交易者在收盘时会保留 1 手多单和 1 手空单，使得原始 OI 曲线出现 “山谷” 形态。我们基于当日成交量权重来区分 T+0 与 T+1 交易者的持仓变化，从而得到真实的长、短线资金意图。

3. **DOV 指标**  
   - 每分钟（或日内）计算 `|∆OI| / (∆Volume)`，再得到均值或标准差。  
   - 若 DOV_mean 或 DOV_std 较高，说明当日主要是机构或结构波动大，当日情绪已经充分消化，次日往往会反转；否则是散户主导，次日更易延续当日趋势。

4. **止盈止损**  
   - 本策略在 `on_bar` 中每分钟检查 `bar.close_price` 相对于 `entry_price` 是否超出设定的止损 / 止盈百分比，并及时平仓。

5. **跨日信号**  
   - 将当日收盘前统计好的多空信号，放在下一交易日开盘执行，若连续两天信号相同则保持仓位不动，否则平仓反手。
     

## 参考研报

- **2020 年 02 月 23 日 · 东吴证券研究所**  
  [《“技术分析拥抱选股因子”系列研究（一）：高频价量相关性，意想不到的选股因子》](https://github.com/jinwukong/-vnpy-CTA-/blob/main/20200223-%E4%B8%9C%E5%90%B4%E8%AF%81%E5%88%B8-%E2%80%9C%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90%E6%8B%A5%E6%8A%B1%E9%80%89%E8%82%A1%E5%9B%A0%E5%AD%90%E2%80%9D%E7%B3%BB%E5%88%97%E7%A0%94%E7%A9%B6%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E9%AB%98%E9%A2%91%E4%BB%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E6%80%A7%EF%BC%8C%E6%84%8F%E6%83%B3%E4%B8%8D%E5%88%B0%E7%9A%84%E9%80%89%E8%82%A1%E5%9B%A0%E5%AD%90.pdf)  

- **2020 年 06 月 18 日 · 东吴证券研究所**  
  [《“高频价量相关性拥抱 CTA”系列研究（一）：CPV 因子期货版》](https://github.com/jinwukong/-vnpy-CTA-/blob/main/20200618-%E4%B8%9C%E5%90%B4%E8%AF%81%E5%88%B8-%E2%80%9C%E9%AB%98%E9%A2%91%E4%BB%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E6%80%A7%E6%8B%A5%E6%8A%B1CTA%E2%80%9D%E7%B3%BB%E5%88%97%E7%A0%94%E7%A9%B6%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9ACPV%E5%9B%A0%E5%AD%90%E6%9C%9F%E8%B4%A7%E7%89%88.pdf)

- **2023 年 02 月 13 日 · 东吴证券研究所**  
  [《“高频价量相关性拥抱 CTA”系列研究（二）：CPV 因子期货版 2.0 —— 样本内外的动量反转》](https://github.com/jinwukong/-vnpy-CTA-/blob/main/20230213-%E4%B8%9C%E5%90%B4%E8%AF%81%E5%88%B8-%E2%80%9C%E9%AB%98%E9%A2%91%E4%BB%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E6%80%A7%E6%8B%A5%E6%8A%B1CTA%E2%80%9D%E7%B3%BB%E5%88%97%E7%A0%94%E7%A9%B6%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9ACPV%E5%9B%A0%E5%AD%90%E6%9C%9F%E8%B4%A7%E7%89%882.0~%E6%A0%B7%E6%9C%AC%E5%86%85%E5%A4%96%E7%9A%84%E5%8A%A8%E9%87%8F%E5%8F%8D%E8%BD%AC.pdf)

- **2024 年 09 月 02 日 · 东吴证券研究所**  
  [《“高频价量相关性拥抱 CTA”系列研究（四）：CPV 因子期货版 3.0，CPV 测谎机》](https://github.com/jinwukong/-vnpy-CTA-/blob/main/20240902-%E4%B8%9C%E5%90%B4%E8%AF%81%E5%88%B8-%E2%80%9C%E9%AB%98%E9%A2%91%E4%BB%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E6%80%A7%E6%8B%A5%E6%8A%B1CTA%E2%80%9D%E7%B3%BB%E5%88%97%E7%A0%94%E7%A9%B6%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9ACPV%E5%9B%A0%E5%AD%90%E6%9C%9F%E8%B4%A7%E7%89%883.0%EF%BC%8CCPV%E6%B5%8B%E8%B0%8E%E6%9C%BA.pdf)

## 免责声明

- 此代码仅作学术研究和交流示例，不构成任何投资建议。
- 实际使用中请结合自身资金、滑点、参数调优、风险偏好等作充分测试。
